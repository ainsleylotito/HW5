---
title: "Homework 5"
author: "Ainsley Lotito"
date: "November 12, 2025"
output: pdf_document
--- 

# Looking at the `data` subdirectory 

*Write a piece of code that lists the files you saved in the `data` subdirectory.* 

```{r}
list.files("../data")
```

# Mapping a city  

*Pick one city in the data. Create a map showing the locations of the homicides in that city, using the `sf` framework discussed in class. Use *`tigris` *to download boundaries for some sub-city geography (e.g., tracts, block groups, county subdivisions) to show as a layer underneath the points showing homicides. Use different facets for solved versus unsolved homicides and different colors to show the three race groups with the highest number of homicides for that city (you may find the* `fct_lump` *function from forcats useful for this).*

## Importing data 

To start off, let's read in the data and take a look at the cities we may choose from. 

```{r, results = FALSE, warning = FALSE, message = FALSE}
library(tidyverse)
library(forcats)
library(tigris) 
library(labelled)

homicides <- read.csv("../data/homicide-data.csv") 
unique(homicides$city)
```

I think it would be fun to use Baton Rouge, so I am  going to create an object containing just the observations for Baton Rouge.

```{r}
baton_rouge <- homicides %>% 
  filter(city == "Baton Rouge")  
dim(baton_rouge)
baton_rouge %>% 
  slice(1:3)
``` 

```{r, eval = FALSE, echo = FALSE}

table(baton_rouge$victim_race)
table(baton_rouge$victim_sex) 
table(baton_rouge$victim_age) #need to handle "Unknown"
unique(baton_rouge$disposition) #looking through the levels of disposition
``` 
I have data on 424 homicides in Baton Rouge, with 12 columns which include identifying information (the id, victim name, race, age, sex), the latitude and longitude, and the disposition. I need to do some data cleaning to re-categorize some variables, and to determine whether the case is solved vs. unsolved.  

```{r}

baton_rouge <- baton_rouge %>% 
    mutate(reported_date = ymd(reported_date),
           
           case_status = case_when(
             disposition == "Open/No arrest" ~ "Solved", 
             disposition %in% c("Closed by arrest","Closed without arrest")
             ~ "Unsolved"),
           case_status = factor(case_status), 
           
           victim_age = victim_age %>% 
             na_if("Unknown") %>% 
             as.numeric(),
           
          victim_sex = fct_relevel(victim_sex,
                                  "Male", "Female"), #Ordering by count
          
          victim_race = fct_relevel(victim_race,
                                   "Black", "White", "Hispanic", "Other", "Asian") #Ordering by count
          )  
baton_rouge %>% 
  slice(1:3)

```
Lastly, I need save as an sf object so I can plot this on a map.

```{r, message = FALSE, results = FALSE}
#changing to an sf object  
library(sf)
baton_rouge_sf <- st_as_sf(baton_rouge, coords = c("lon", "lat")) %>% 
  st_set_crs(4269)
baton_rouge_sf %>% slice(1:3)
dim(baton_rouge_sf)
```

Making a map of baton rouge. I need to pull some tracts, block groups, and county subdivisions from tigris. 
The FIPS code for East Baton Rouge Parish is 22033, and West is 22121. I can therefore select by the countyFP of 033 and 121. 
I am going to start by just making a base map of Baton Rouge before I add my homicide data. 


```{r, message= FALSE, results = FALSE}
library(tigris)
la_tracts <- tracts(state = "LA") #tracts first
ba_tracts <- la_tracts %>% 
  filter(COUNTYFP %in% c("033", "121")) 

la_blocks <- block_groups(state = "LA")
ba_blocks<- la_blocks %>% 
  filter(COUNTYFP %in% c("033", "121"))  

ba_subdivisions <- county_subdivisions("LA", county = c("033", "121"))
```

```{r, fig.width = 4.5, fig.height=4.5}
ggplot() +
  geom_sf(data = ba_subdivisions, fill = NA, color = "black", size = 0.7) + #subdivisions
  geom_sf(data = ba_tracts, fill = "white", color = "gray", size = 0.3) + #tracts
  geom_sf(data = ba_blocks, fill = NA, color = "lightgray", size = 0.1) + #blocks
  theme_minimal() + 
  labs(title = "Baton Rouge, Louisiana")   

```  


Now that I have a basemap, I can look into adding some homicide info. 
The first map is going to just show the locations of each homicide. 

```{r, fig.width = 4.5, fig.height=4.5}
ggplot() +
  geom_sf(data = ba_subdivisions, fill = NA, color = "black", size = 0.7) + #subdivisions
  geom_sf(data = ba_tracts, fill = "white", color = "gray60", size = 0.3) + #tracts
  geom_sf(data = ba_blocks, fill = NA, color = "gray85", size = 0.1) + #blocks
  geom_sf(data = baton_rouge_sf, color = "darkred", size = 0.9, alpha = .6) +
  theme_minimal() + 
  xlim(c(-91.22, -90.97)) + ylim(c(30.38, 30.57)) + #zooming in to points 
  labs(title = "Homicides in Baton Rouge, LA",
       subtitle = "Jan 3, 2011 - Dec 31, 2017")
``` 

Next we are going to look at solved versus unsolved homicides, and use different colors for the three race groups with the highest number of homicides. I also got some errors and found that I will need to use the command inherit.aes = FALSE for each sf layer without the case_status faceting variable (all the geography ones)
```{r, fig.width = 9, fig.height=6}
top3_races <- baton_rouge_sf %>% 
  group_by(victim_race) %>% 
  count() %>% 
  slice(1:3)  

baton_rouge_sf_top3 <- baton_rouge_sf %>% 
  filter(victim_race %in% top3_races$victim_race) %>% 
  set_variable_labels(
    victim_race = "Racial Group of Victim"
  )


ggplot() +
  geom_sf(data = ba_subdivisions, fill = NA, color = "black", size = 0.7,
          inherit.aes = FALSE) + #subdivisions
  geom_sf(data = ba_tracts, fill = "white", color = "gray60", size = 0.3,
          inherit.aes = FALSE) + #tracts
  geom_sf(data = ba_blocks, fill = NA, color = "gray85", size = 0.1,
          inherit.aes = FALSE) + #blocks
  
  geom_sf(data = baton_rouge_sf_top3, aes(color = victim_race), size = 1.1, alpha = .6) +
  facet_wrap(~ case_status)+
  theme_minimal() + 
  xlim(c(-91.22, -90.97)) + ylim(c(30.38, 30.57)) + #zooming in to points 
  labs(title = "Homicides in Baton Rouge 2011 - 2017",
       subtitle = "By Racial Group and Case Status")+ 
  theme(plot.title = element_text(hjust = 0.5), 
        plot.subtitle = element_text(hjust = 0.5))
```
